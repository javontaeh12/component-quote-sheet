<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Component Quote Sheet</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #1a3a5c;
    --primary-light: #2a5a8c;
    --accent: #c0392b;
    --bg: #eef1f5;
    --card: #ffffff;
    --border: #d0d5dd;
    --border-focus: #2a5a8c;
    --text: #1a1a2e;
    --text-muted: #667085;
    --input-bg: #f8f9fb;
    --section-bg: #f1f4f8;
    --success: #27ae60;
    --shadow: 0 4px 24px rgba(0,0,0,0.08);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  html, body {
    overflow-x: hidden;
    max-width: 100vw;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    padding: 0;
    color: var(--text);
    -webkit-font-smoothing: antialiased;
    -webkit-tap-highlight-color: transparent;
  }

  .form-container {
    max-width: 940px;
    margin: 0 auto;
    background: var(--card);
    min-height: 100vh;
  }

  /* Header */
  .form-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: #fff;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.15);
  }
  .form-header h1 {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.3px;
  }
  .form-header .subtitle {
    font-size: 11px;
    opacity: 0.75;
    font-weight: 400;
    margin-top: 2px;
  }
  .header-badge {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.25);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    white-space: nowrap;
  }

  .form-body { padding: 16px; }

  /* Section */
  .section {
    margin-bottom: 20px;
  }
  .section-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--primary);
  }
  .section-header .section-icon {
    width: 26px; height: 26px;
    background: var(--primary);
    color: #fff;
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 700;
    flex-shrink: 0;
  }
  .section-header h2 {
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--primary);
  }

  /* Rows & Fields */
  .row {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }
  .field {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-width: 100%;
  }
  .field.half { min-width: calc(50% - 5px); }
  .field.third { min-width: calc(33.33% - 7px); }
  .field label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
    color: var(--text-muted);
  }
  .field label .hint {
    font-weight: 400;
    text-transform: none;
    letter-spacing: 0;
    color: #98a2b3;
    font-size: 10px;
  }
  .field input,
  .field select,
  .field textarea {
    padding: 12px 14px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    font-size: 16px;
    font-family: inherit;
    background: var(--input-bg);
    color: var(--text);
    transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    -webkit-appearance: none;
    appearance: none;
  }
  .field input:focus,
  .field select:focus,
  .field textarea:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(42,90,140,0.12);
    background: #fff;
  }
  .field input::placeholder, .field textarea::placeholder { color: #b0b8c4; }
  .field textarea {
    resize: vertical;
    min-height: 70px;
    line-height: 1.5;
  }
  .field select {
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23667085' d='M2.5 4.5L6 8l3.5-3.5'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 14px center;
    padding-right: 36px;
  }

  /* Inline page fields */
  .page-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .page-group input {
    width: 60px;
    text-align: center;
    padding: 12px 8px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    font-size: 16px;
    font-family: inherit;
    background: var(--input-bg);
    color: var(--text);
    transition: border-color 0.2s, box-shadow 0.2s;
    -webkit-appearance: none;
  }
  .page-group input:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(42,90,140,0.12);
    background: #fff;
  }
  .page-group span {
    font-weight: 600;
    color: var(--text-muted);
    font-size: 14px;
  }

  /* Status pills */
  .status-field {
    flex: 1;
    min-width: calc(50% - 5px);
  }
  .status-field label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
    color: var(--text-muted);
    display: block;
  }
  .pill-group {
    display: flex;
    gap: 0;
    border-radius: 8px;
    overflow: hidden;
    border: 1.5px solid var(--border);
  }
  .pill-group input[type="radio"] { display: none; }
  .pill-group label.pill {
    flex: 1;
    text-align: center;
    padding: 12px 16px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    background: var(--input-bg);
    color: var(--text-muted);
    transition: all 0.2s;
    text-transform: none;
    letter-spacing: 0;
    margin: 0;
    border-right: 1px solid var(--border);
    -webkit-tap-highlight-color: transparent;
  }
  .pill-group label.pill:last-of-type { border-right: none; }
  .pill-group input[type="radio"]:checked + label.pill {
    background: var(--primary);
    color: #fff;
  }

  /* ── Mobile Parts Cards ── */
  .parts-list { display: flex; flex-direction: column; gap: 10px; margin-top: 8px; }
  .part-card {
    background: var(--input-bg);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 14px;
    position: relative;
  }
  .part-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .part-card-num {
    background: var(--primary);
    color: #fff;
    width: 24px; height: 24px;
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 700;
  }
  .part-card .remove-btn {
    background: none;
    color: #ccc;
    border: none;
    font-size: 22px;
    line-height: 1;
    padding: 4px 8px;
    cursor: pointer;
    border-radius: 6px;
    -webkit-tap-highlight-color: transparent;
  }
  .part-card .remove-btn:active { color: var(--accent); background: #fef2f2; }
  .part-card-fields {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .part-card-fields .pf {
    display: flex;
    flex-direction: column;
    min-width: 100%;
  }
  .part-card-fields .pf.half { min-width: calc(50% - 4px); }
  .part-card-fields .pf label {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.4px;
    color: var(--text-muted);
    margin-bottom: 3px;
  }
  .part-card-fields .pf input {
    padding: 10px 12px;
    border: 1.5px solid var(--border);
    border-radius: 6px;
    font-size: 15px;
    font-family: inherit;
    background: #fff;
    color: var(--text);
    -webkit-appearance: none;
    transition: border-color 0.2s;
  }
  .part-card-fields .pf input:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(42,90,140,0.12);
  }
  .part-card-fields .pf input::placeholder { color: #c5cad2; }

  /* Desktop table (hidden on mobile) */
  .parts-wrapper { display: none; }
  .parts-table { width: 100%; border-collapse: collapse; }
  .parts-table thead th {
    background: var(--primary); color: #fff;
    padding: 10px 12px; font-size: 11px; font-weight: 600;
    text-align: left; text-transform: uppercase; letter-spacing: 0.8px;
  }
  .parts-table td { padding: 3px 4px; }
  .parts-table tbody tr { border-bottom: 1px solid #eef0f3; }
  .parts-table tbody tr:last-child { border-bottom: none; }
  .parts-table input {
    width: 100%; padding: 8px 10px;
    border: 1.5px solid transparent; border-radius: 4px;
    font-size: 13px; font-family: inherit;
    background: transparent; color: var(--text);
  }
  .parts-table input:focus { outline: none; border-color: var(--border-focus); background: #fff; }
  .parts-table .row-num { width: 30px; text-align: center; color: var(--text-muted); font-size: 11px; font-weight: 600; }
  .parts-table .remove-btn {
    background: none; color: #d0d5dd; border: none; border-radius: 4px;
    cursor: pointer; padding: 4px 8px; font-size: 16px; line-height: 1;
  }

  .table-actions {
    margin-top: 12px;
  }
  .add-row-btn {
    padding: 14px 20px;
    background: var(--section-bg);
    color: var(--primary);
    border: 1.5px dashed var(--border);
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    font-family: inherit;
    width: 100%;
    text-align: center;
    -webkit-tap-highlight-color: transparent;
  }
  .add-row-btn:active { background: #e4e9f0; border-color: var(--primary); }

  /* Action Buttons */
  .actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1.5px solid #eef0f3;
  }
  .actions button {
    padding: 14px 12px;
    font-size: 13px;
    font-weight: 600;
    font-family: inherit;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    -webkit-tap-highlight-color: transparent;
    transition: opacity 0.15s;
  }
  .actions button:active { opacity: 0.8; }
  .btn-download {
    background: var(--primary);
    color: #fff;
  }
  .btn-photo {
    background: #8e44ad;
    color: #fff;
  }
  .btn-print {
    background: var(--success);
    color: #fff;
  }
  .btn-reset {
    background: #fff;
    color: var(--text-muted);
    border: 1.5px solid var(--border) !important;
  }

  /* Footer */
  .form-footer {
    background: var(--section-bg);
    padding: 14px 16px;
    text-align: center;
    font-size: 10px;
    color: var(--text-muted);
    border-top: 1px solid #e4e7ec;
  }

  /* ── Desktop overrides ── */
  @media (min-width: 768px) {
    body { padding: 30px 20px; }
    .form-container {
      border-radius: 12px;
      box-shadow: var(--shadow);
      min-height: auto;
    }
    .form-header {
      padding: 28px 40px;
      position: static;
      box-shadow: none;
    }
    .form-header h1 { font-size: 24px; }
    .form-header .subtitle { font-size: 13px; }
    .header-badge { padding: 8px 16px; font-size: 12px; }
    .form-body { padding: 32px 40px 40px; }
    .field { min-width: 170px; }
    .field.half { min-width: 170px; }
    .field.third { min-width: 170px; }
    .field input, .field select, .field textarea { font-size: 14px; padding: 9px 12px; }
    .page-group input { font-size: 14px; padding: 9px 6px; width: 52px; }
    .pill-group label.pill { padding: 9px 16px; font-size: 13px; }
    .status-field { min-width: 170px; }
    .part-card-fields .pf input { font-size: 13px; padding: 8px 10px; }
    .parts-list { display: none; }
    .parts-wrapper {
      display: block;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      margin-top: 8px;
    }
    .add-row-btn { width: auto; padding: 8px 20px; font-size: 13px; }
    .actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .actions button { padding: 12px 32px; font-size: 14px; }
    .form-footer { padding: 16px 40px; font-size: 11px; }
  }

  /* Print styles */
  @media print {
    body { background: #fff; padding: 0; }
    .form-container { box-shadow: none; border-radius: 0; }
    .form-header { position: static; box-shadow: none; padding: 20px 30px; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .form-body { padding: 20px 30px; }
    .actions, .add-row-btn, .remove-btn, .table-actions, .form-footer { display: none !important; }
    .parts-table thead th { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .section-header .section-icon { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .field input, .field select, .field textarea {
      border: none; border-bottom: 1.5px solid #333; border-radius: 0;
      background: transparent !important; padding: 6px 2px; box-shadow: none; font-size: 12px;
    }
    .parts-list { display: flex !important; }
    .part-card { break-inside: avoid; }
    .part-card .remove-btn { display: none; }
    .part-card-fields .pf input { border: none; border-bottom: 1px solid #ccc; border-radius: 0; font-size: 11px; padding: 4px 2px; }
    .pill-group { border: none; }
    .pill-group label.pill { border: 1px solid #ccc; }
    .pill-group input[type="radio"]:checked + label.pill { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  }
</style>
</head>
<body>

<div class="form-container" id="quoteForm">

  <!-- Header -->
  <div class="form-header">
    <div>
      <h1>Component Quote Sheet</h1>
      <div class="subtitle">HVAC / Refrigeration Service</div>
    </div>
    <div class="header-badge">Service Quote</div>
  </div>

  <div class="form-body">

    <!-- SECTION 1: Job Information -->
    <div class="section">
      <div class="section-header">
        <div class="section-icon">1</div>
        <h2>Job Information</h2>
      </div>
      <div class="row">
        <div class="field"><label>Customer Name</label><input type="text" id="customerName" placeholder="Enter customer name"></div>
      </div>
      <div class="row">
        <div class="field half"><label>Store #</label><input type="text" id="storeNumber" placeholder="Store #"></div>
        <div class="field half"><label>WO Number</label><input type="text" id="woNumber" placeholder="Work order #"></div>
      </div>
      <div class="row">
        <div class="field half"><label>Tech</label><input type="text" id="tech" placeholder="Technician name"></div>
        <div class="field half">
          <label>Page</label>
          <div class="page-group">
            <input type="text" id="pageNum" placeholder="#"> <span>of</span>
            <input type="text" id="pageOf" placeholder="#">
          </div>
        </div>
      </div>
    </div>

    <!-- SECTION 2: Equipment Details -->
    <div class="section">
      <div class="section-header">
        <div class="section-icon">2</div>
        <h2>Equipment Details</h2>
      </div>
      <div class="row">
        <div class="field"><label>Equipment Type</label><input type="text" id="equipmentType" placeholder="e.g. RTU, Condenser, Walk-in Cooler"></div>
      </div>
      <div class="row">
        <div class="field">
          <label>Location</label>
          <select id="location">
            <option value="">-- Select Location --</option>
            <option value="Roof">Roof</option>
            <option value="Ground">Ground</option>
            <option value="Self-Contained">Self-Contained</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>Manufacturer <span class="hint">- type to search or enter custom</span></label>
          <input type="text" id="manufacturer" list="mfgList" placeholder="Select or type manufacturer" autocomplete="off">
          <datalist id="mfgList">
            <option value="AAON">
            <option value="ADP (Advanced Distributor Products)">
            <option value="Aire-Flo">
            <option value="Amana">
            <option value="American Standard">
            <option value="Armstrong Air">
            <option value="Bard Manufacturing">
            <option value="Bosch">
            <option value="Bryant">
            <option value="Carrier">
            <option value="Comfortmaker">
            <option value="Daikin">
            <option value="Dunham-Bush">
            <option value="Friedrich">
            <option value="Fujitsu">
            <option value="Goodman">
            <option value="Heil">
            <option value="Honeywell">
            <option value="ICP (International Comfort Products)">
            <option value="Johnson Controls">
            <option value="Lennox">
            <option value="LG">
            <option value="Luxaire">
            <option value="Mammoth">
            <option value="McQuay International">
            <option value="Mitsubishi Electric">
            <option value="Modine">
            <option value="Nortek">
            <option value="Payne">
            <option value="Reznor">
            <option value="Rheem">
            <option value="Ruud">
            <option value="Samsung">
            <option value="Trane">
            <option value="York">
            <option value="Bally Refrigerated Boxes">
            <option value="Beacon/Morris">
            <option value="Bohn (Heatcraft)">
            <option value="Bristol Compressors">
            <option value="Climate Master">
            <option value="Copeland (Emerson)">
            <option value="Danfoss">
            <option value="Embraco">
            <option value="Heatcraft">
            <option value="Hill Phoenix">
            <option value="Hussmann">
            <option value="KeepRite Refrigeration">
            <option value="Kelvinator Commercial">
            <option value="Kolpak">
            <option value="Kramer Trenton">
            <option value="Kysor/Warren">
            <option value="Larkin (Heatcraft)">
            <option value="Master-Bilt">
            <option value="McCall">
            <option value="Nor-Lake">
            <option value="Randell">
            <option value="Russell">
            <option value="Sporlan">
            <option value="Sub-Zero Commercial">
            <option value="Tecumseh">
            <option value="Traulsen">
            <option value="True Manufacturing">
            <option value="Turbo Air">
            <option value="Tyler Refrigeration">
            <option value="Victory Refrigeration">
            <option value="Walk-In Cooler Warehouse">
            <option value="Zero Zone">
          </datalist>
        </div>
      </div>
      <div class="row">
        <div class="field"><label>Unit</label><input type="text" id="unit" placeholder="Unit ID"></div>
      </div>
      <div class="row">
        <div class="field"><label>Model #</label><input type="text" id="modelNumber" placeholder="Model number"></div>
      </div>
      <div class="row">
        <div class="field"><label>Serial #</label><input type="text" id="serialNumber" placeholder="Serial number"></div>
      </div>
      <div class="row">
        <div class="field half"><label>Voltage</label><input type="text" id="voltage" placeholder="e.g. 208/230"></div>
        <div class="field half"><label>Phase</label><input type="text" id="phase" placeholder="e.g. 1, 3"></div>
      </div>
      <div class="row">
        <div class="status-field">
          <label>Warranty</label>
          <div class="pill-group">
            <input type="radio" name="warranty" id="warrantyYes" value="Yes">
            <label class="pill" for="warrantyYes">Yes</label>
            <input type="radio" name="warranty" id="warrantyNo" value="No">
            <label class="pill" for="warrantyNo">No</label>
          </div>
        </div>
        <div class="status-field">
          <label>Operational</label>
          <div class="pill-group">
            <input type="radio" name="operational" id="operationalYes" value="Yes">
            <label class="pill" for="operationalYes">Yes</label>
            <input type="radio" name="operational" id="operationalNo" value="No">
            <label class="pill" for="operationalNo">No</label>
          </div>
        </div>
      </div>
    </div>

    <!-- SECTION 3: Service Details -->
    <div class="section">
      <div class="section-header">
        <div class="section-icon">3</div>
        <h2>Service Details</h2>
      </div>
      <div class="row">
        <div class="field"><label>Work Performed</label><textarea id="workPerformed" rows="3" placeholder="Describe work performed..."></textarea></div>
      </div>
      <div class="row">
        <div class="field"><label>Reason for Repair</label><textarea id="reasonForRepair" rows="3" placeholder="Describe reason for repair..."></textarea></div>
      </div>
      <div class="row">
        <div class="field"><label>Equipment Needed <span class="hint">- scissor lift, duct jack, 40' ladder, etc.</span></label><textarea id="equipmentNeeded" rows="2" placeholder="List any special equipment needed..."></textarea></div>
      </div>
      <div class="row">
        <div class="field"><label>Other Comments</label><textarea id="otherComments" rows="2" placeholder="Additional notes or comments..."></textarea></div>
      </div>
    </div>

    <!-- SECTION 4: Logistics -->
    <div class="section">
      <div class="section-header">
        <div class="section-icon">4</div>
        <h2>Logistics</h2>
      </div>
      <div class="row">
        <div class="status-field" style="min-width:100%;">
          <label>Boom Truck Needed?</label>
          <div class="pill-group">
            <input type="radio" name="boomTruck" id="boomYes" value="Yes">
            <label class="pill" for="boomYes">Yes</label>
            <input type="radio" name="boomTruck" id="boomNo" value="No">
            <label class="pill" for="boomNo">No</label>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="field third"><label>Up</label><input type="text" id="boomUp" placeholder="ft"></div>
        <div class="field third"><label>In</label><input type="text" id="boomIn" placeholder="ft"></div>
        <div class="field third"><label>Set Back</label><input type="text" id="boomSetBack" placeholder="ft"></div>
      </div>
      <div class="row">
        <div class="field third"><label>Tech Hours</label><input type="text" id="techHours" placeholder="Hrs"></div>
        <div class="field third"><label>Helper</label><input type="text" id="helperHours" placeholder="Hrs"></div>
        <div class="field third"><label>Travel</label><input type="text" id="travelHours" placeholder="Hrs"></div>
      </div>
    </div>

    <!-- SECTION 5: Parts -->
    <div class="section">
      <div class="section-header">
        <div class="section-icon">5</div>
        <h2>Parts & Materials</h2>
      </div>

      <!-- Mobile: Card layout -->
      <div class="parts-list" id="partsList"></div>

      <!-- Desktop: Table layout -->
      <div class="parts-wrapper">
        <table class="parts-table" id="partsTable">
          <thead>
            <tr>
              <th style="width:30px;">#</th>
              <th>Description</th>
              <th style="width:140px;">Part #</th>
              <th style="width:80px;">Qty</th>
              <th style="width:110px;">Cost</th>
              <th style="width:130px;">Vendor</th>
              <th style="width:36px;"></th>
            </tr>
          </thead>
          <tbody id="partsBody"></tbody>
        </table>
      </div>

      <div class="table-actions">
        <button class="add-row-btn" type="button" onclick="addPartRow()">+ Add Part</button>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="actions">
      <button class="btn-download" onclick="downloadPDF()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 1v9m0 0L5 7m3 3l3-3M2 12v1.5A1.5 1.5 0 003.5 15h9a1.5 1.5 0 001.5-1.5V12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        PDF
      </button>
      <button class="btn-photo" onclick="saveAsPhoto()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 4.5A1.5 1.5 0 013.5 3h1.172a1.5 1.5 0 011.06.44L6.94 4.646A.5.5 0 007.293 4.5H12.5A1.5 1.5 0 0114 6v6.5a1.5 1.5 0 01-1.5 1.5h-9A1.5 1.5 0 012 12.5v-8z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="8" cy="9" r="2.5" stroke="currentColor" stroke-width="1.5"/></svg>
        Photo
      </button>
      <button class="btn-print" onclick="window.print()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 6V1h8v5M4 12H2.5A1.5 1.5 0 011 10.5v-4A1.5 1.5 0 012.5 5h11A1.5 1.5 0 0115 6.5v4a1.5 1.5 0 01-1.5 1.5H12M4 9h8v6H4V9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Print
      </button>
      <button class="btn-reset" onclick="resetForm()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 2v4.5h4.5M14 14v-4.5H9.5M1.5 10a6.5 6.5 0 0111.48-3M14.5 6a6.5 6.5 0 01-11.48 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Reset
      </button>
    </div>

  </div>

  <div class="form-footer">
    Component Quote Sheet &mdash; All fields auto-save. Your data will be here when you come back.
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  const STORAGE_KEY = 'componentQuoteSheet';
  let rowCount = 0;
  let isRestoring = false;

  const fieldIds = [
    'customerName','storeNumber','woNumber','tech','pageNum','pageOf',
    'equipmentType','location','manufacturer','unit','modelNumber','serialNumber',
    'voltage','phase','workPerformed','reasonForRepair','equipmentNeeded',
    'otherComments','boomUp','boomIn','boomSetBack','techHours','helperHours','travelHours'
  ];
  const radioNames = ['warranty','operational','boomTruck'];

  // ── Save ──
  function saveForm() {
    if (isRestoring) return;
    const data = {};
    fieldIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) data[id] = el.value;
    });
    radioNames.forEach(name => {
      const checked = document.querySelector(`input[name="${name}"]:checked`);
      data['radio_' + name] = checked ? checked.value : '';
    });
    // Parts from cards (mobile source of truth, synced to table)
    const parts = [];
    document.querySelectorAll('#partsList .part-card').forEach(card => {
      const inputs = card.querySelectorAll('input');
      const row = [];
      inputs.forEach(inp => row.push(inp.value));
      parts.push(row);
    });
    data.parts = parts;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  // ── Restore ──
  function restoreForm() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) {
      for (let i = 0; i < 6; i++) addPartRow();
      return;
    }
    isRestoring = true;
    const data = JSON.parse(raw);
    fieldIds.forEach(id => {
      const el = document.getElementById(id);
      if (el && data[id] !== undefined) el.value = data[id];
    });
    radioNames.forEach(name => {
      const val = data['radio_' + name];
      if (val) {
        const radio = document.querySelector(`input[name="${name}"][value="${val}"]`);
        if (radio) radio.checked = true;
      }
    });
    if (data.parts && data.parts.length > 0) {
      data.parts.forEach(rowData => {
        addPartRow();
        // Fill card
        const card = document.querySelector('#partsList .part-card:last-child');
        const cardInputs = card.querySelectorAll('input');
        rowData.forEach((val, i) => { if (cardInputs[i]) cardInputs[i].value = val; });
        // Fill table row
        const tr = document.querySelector('#partsBody tr:last-child');
        const trInputs = tr.querySelectorAll('input');
        rowData.forEach((val, i) => { if (trInputs[i]) trInputs[i].value = val; });
      });
    } else {
      for (let i = 0; i < 6; i++) addPartRow();
    }
    isRestoring = false;
  }

  // ── Add Part Row (both card + table) ──
  function addPartRow() {
    rowCount++;
    const n = rowCount;

    // Card (mobile)
    const list = document.getElementById('partsList');
    const card = document.createElement('div');
    card.className = 'part-card';
    card.dataset.row = n;
    card.innerHTML = `
      <div class="part-card-header">
        <div class="part-card-num">${n}</div>
        <button class="remove-btn" onclick="removeRow(${n})" title="Remove">&times;</button>
      </div>
      <div class="part-card-fields">
        <div class="pf"><label>Description</label><input type="text" placeholder="Part description" data-col="0"></div>
        <div class="pf half"><label>Part #</label><input type="text" placeholder="Part #" data-col="1"></div>
        <div class="pf half"><label>Qty</label><input type="text" placeholder="Qty" data-col="2"></div>
        <div class="pf half"><label>Cost</label><input type="text" placeholder="$0.00" data-col="3"></div>
        <div class="pf half"><label>Vendor</label><input type="text" placeholder="Vendor" data-col="4"></div>
      </div>
    `;
    list.appendChild(card);

    // Table row (desktop)
    const tbody = document.getElementById('partsBody');
    const tr = document.createElement('tr');
    tr.dataset.row = n;
    tr.innerHTML = `
      <td class="row-num">${n}</td>
      <td><input type="text" placeholder="Part description" data-col="0"></td>
      <td><input type="text" placeholder="Part #" data-col="1"></td>
      <td><input type="text" placeholder="Qty" data-col="2"></td>
      <td><input type="text" placeholder="$0.00" data-col="3"></td>
      <td><input type="text" placeholder="Vendor" data-col="4"></td>
      <td style="text-align:center;"><button class="remove-btn" onclick="removeRow(${n})" title="Remove">&times;</button></td>
    `;
    tbody.appendChild(tr);

    // Sync card inputs <-> table inputs
    const cardInputs = card.querySelectorAll('input');
    const trInputs = tr.querySelectorAll('input');
    cardInputs.forEach((inp, i) => {
      inp.addEventListener('input', () => {
        if (trInputs[i]) trInputs[i].value = inp.value;
        saveForm();
      });
    });
    trInputs.forEach((inp, i) => {
      inp.addEventListener('input', () => {
        if (cardInputs[i]) cardInputs[i].value = inp.value;
        saveForm();
      });
    });

    if (!isRestoring) saveForm();
  }

  function removeRow(n) {
    const card = document.querySelector(`#partsList .part-card[data-row="${n}"]`);
    const tr = document.querySelector(`#partsBody tr[data-row="${n}"]`);
    if (card) card.remove();
    if (tr) tr.remove();
    renumberRows();
    saveForm();
  }

  function renumberRows() {
    rowCount = 0;
    document.querySelectorAll('#partsList .part-card').forEach((card, i) => {
      rowCount = i + 1;
      card.querySelector('.part-card-num').textContent = rowCount;
    });
    document.querySelectorAll('#partsBody tr').forEach((tr, i) => {
      tr.querySelector('.row-num').textContent = i + 1;
    });
  }

  // ── Attach save listeners ──
  fieldIds.forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener('input', saveForm);
      el.addEventListener('change', saveForm);
    }
  });
  radioNames.forEach(name => {
    document.querySelectorAll(`input[name="${name}"]`).forEach(radio => {
      radio.addEventListener('change', saveForm);
    });
  });

  // ── Restore on load ──
  restoreForm();

  // ── Export helpers ──
  function hideUI() {
    const els = {
      actions: document.querySelector('.actions'),
      tableActions: document.querySelector('.table-actions'),
      footer: document.querySelector('.form-footer'),
      removeBtns: document.querySelectorAll('.remove-btn'),
    };
    els.actions.style.display = 'none';
    els.tableActions.style.display = 'none';
    els.footer.style.display = 'none';
    els.removeBtns.forEach(b => b.style.display = 'none');
    return els;
  }
  function showUI(els) {
    els.actions.style.display = '';
    els.tableActions.style.display = '';
    els.footer.style.display = '';
    els.removeBtns.forEach(b => b.style.display = '');
  }
  function getFilename(ext) {
    const c = document.getElementById('customerName').value || 'Quote';
    const w = document.getElementById('woNumber').value || '';
    return `Component_Quote_${c.replace(/\s+/g, '_')}${w ? '_WO' + w : ''}.${ext}`;
  }

  function downloadPDF() {
    const ui = hideUI();
    const el = document.getElementById('quoteForm');
    html2pdf().set({
      margin: [6, 6, 6, 6],
      filename: getFilename('pdf'),
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'mm', format: 'letter', orientation: 'portrait' },
      pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
    }).from(el).save().then(() => showUI(ui));
  }

  function saveAsPhoto() {
    const ui = hideUI();
    const el = document.getElementById('quoteForm');
    html2canvas(el, { scale: 2, useCORS: true, backgroundColor: '#ffffff' }).then(canvas => {
      const link = document.createElement('a');
      link.download = getFilename('png');
      link.href = canvas.toDataURL('image/png');
      link.click();
      showUI(ui);
    });
  }

  function resetForm() {
    if (confirm('Clear all fields? This cannot be undone.')) {
      document.querySelectorAll('.form-body input[type="text"], .form-body textarea').forEach(el => el.value = '');
      document.querySelectorAll('.form-body select').forEach(el => el.selectedIndex = 0);
      document.querySelectorAll('.form-body input[type="radio"]').forEach(el => el.checked = false);
      localStorage.removeItem(STORAGE_KEY);
    }
  }
</script>
</body>
</html>
